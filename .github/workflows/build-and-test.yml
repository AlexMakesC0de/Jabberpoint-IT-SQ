name: Build and Test JabberPoint

on:
  pull_request:
    branches: [ develop, production ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up JDK 25
      uses: actions/setup-java@v4
      with:
        java-version: '25'
        distribution: 'temurin'
        
    - name: Compile Java source files
      run: |
        mkdir -p bin
        javac -d bin src/*.java
        
    - name: Verify compilation
      run: |
        CLASS_COUNT=$(ls -1 bin/*.class 2>/dev/null | wc -l)
        if [ "$CLASS_COUNT" -gt 0 ]; then
        echo "Compilation successful! $CLASS_COUNT class files created"
        else
        echo "Compilation failed!"
        exit 1
        fi

        
    - name: Test with demo presentation
      run: |
        echo "Testing application launch with demo mode..."
        timeout 5s java -cp bin JabberPoint || true
        echo "Application can be launched"
        
    - name: Test with XML file
      run: |
        echo "Testing application launch with test.xml..."
        if [ -f test.xml ]; then
          timeout 5s java -cp bin JabberPoint test.xml || true
          echo "XML loading test completed"
        else
          echo "test.xml not found, skipping XML test"
        fi
        
    - name: Build summary
      if: always()
      run: |
        echo "## Build Summary" >> $GITHUB_STEP_SUMMARY
        echo "- Java files compiled: " >> $GITHUB_STEP_SUMMARY
        echo "- Class files generated: $(ls -1 bin/*.class 2>/dev/null | wc -l)" >> $GITHUB_STEP_SUMMARY
        echo "- Application launch: " >> $GITHUB_STEP_SUMMARY
